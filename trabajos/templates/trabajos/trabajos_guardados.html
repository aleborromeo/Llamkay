{% load static %}

<div class="container">
  <h2>Mis Trabajos Guardados</h2>

  {% if trabajos %}
    <div class="trabajos-grid">
      {% for trabajo in trabajos %}
        <div class="tarjeta-trabajo">
          <div class="acciones-trabajo">
            <form method="post" action="{% url 'trabajos:quitar_guardado' trabajo.oferta.id %}" style="display:inline;">
              {% csrf_token %}
              <input type="hidden" name="content_type_id" value="{{ trabajo.content_type.id }}">
              <input type="hidden" name="object_id" value="{{ trabajo.object_id }}">
              <button type="submit" class="btn-quitar" title="Quitar de guardados"
                onclick="return confirm('Â¿EstÃ¡s seguro de que deseas quitar este trabajo guardado?');">
                <img src="{% static 'images/delete.png' %}" alt="Quitar" />
              </button>
            </form>
          </div>

          <h3>{{ trabajo.oferta.titulo }}</h3>
          <p class="fecha-publicacion">Publicado: {{ trabajo.oferta.fecha_registro|date:"d M Y" }}</p>
          {% if trabajo.fecha_guardado %}
            <p class="fecha-guardado">ğŸ’¾ Guardado: {{ trabajo.fecha_guardado|date:"d/m/Y H:i" }}</p>
          {% else %}
            <p class="fecha-guardado">ğŸ’¾ Guardado recientemente</p>
          {% endif %}

          {% if trabajo.oferta.foto %}
            <img src="{{ trabajo.oferta.foto.url }}" alt="Imagen del trabajo" class="imagen-trabajo" />
          {% endif %}

          <div class="contenido-trabajo">
            {% if trabajo.oferta.descripcion %}
              <p><strong>DescripciÃ³n:</strong><br>{{ trabajo.oferta.descripcion }}</p>
            {% elif trabajo.oferta.descripcion_puesto %}
              <p><strong>DescripciÃ³n:</strong><br>{{ trabajo.oferta.descripcion_puesto }}</p>
            {% endif %}

            {% if trabajo.oferta.herramientas %}
              <p><strong>Herramientas:</strong><br>{{ trabajo.oferta.herramientas }}</p>
            {% endif %}

            {% if trabajo.oferta.experiencia_requerida %}
              <p><strong>Experiencia:</strong> {{ trabajo.oferta.experiencia_requerida }}</p>
            {% endif %}

            {% if trabajo.oferta.modalidad_trabajo %}
              <p><strong>Modalidad:</strong> {{ trabajo.oferta.modalidad_trabajo }}</p>
            {% endif %}

            {% if trabajo.oferta.requisitos_calificaciones %}
              <p><strong>Requisitos:</strong> {{ trabajo.oferta.requisitos_calificaciones }}</p>
            {% endif %}

            {% if trabajo.oferta.beneficios_compensaciones %}
              <p><strong>Beneficios:</strong> {{ trabajo.oferta.beneficios_compensaciones }}</p>
            {% endif %}

            <p><strong>DirecciÃ³n:</strong>
              {% if trabajo.oferta.id_departamento %}{{ trabajo.oferta.id_departamento.nombre }}, {% endif %}
              {% if trabajo.oferta.id_provincia %}{{ trabajo.oferta.id_provincia.nombre }}, {% endif %}
              {% if trabajo.oferta.id_distrito %}{{ trabajo.oferta.id_distrito.nombre }}, {% endif %}
              {% if trabajo.oferta.id_comunidad %}{{ trabajo.oferta.id_comunidad.nombre }}{% endif %}
            </p>

            {% if trabajo.oferta.pago %}
              <p><strong>Pago:</strong> S/ {{ trabajo.oferta.pago }}</p>
            {% elif trabajo.oferta.rango_salarial %}
              <p><strong>Rango Salarial:</strong> {{ trabajo.oferta.rango_salarial }}</p>
            {% endif %}

            <p><strong>Fecha LÃ­mite:</strong> {{ trabajo.oferta.fecha_limite }}
              {% if trabajo.oferta.horas_limite %} {{ trabajo.oferta.horas_limite }} {% endif %}
            </p>

            {% if trabajo.oferta.numero_postulantes %}
              <p><strong>Postulantes:</strong> {{ trabajo.oferta.numero_postulantes }}</p>
            {% endif %}

            <!-- Botones de AcciÃ³n como en all_trabajos.html -->
            <div class="contenedor-contacto-mensaje">
              {% if trabajo.oferta.numero_contacto %}
                <a href="https://wa.me/{{ trabajo.oferta.numero_contacto }}?text=Hola%2C%20estoy%20interesado%20en%20la%20oferta%20de%20trabajo%3A%20{{ trabajo.oferta.titulo|urlencode }}" target="_blank" class="boton-contactar">
                  ğŸ“± Contactar 
                </a>
              {% else %}
                <!-- BotÃ³n para iniciar chat interno si no hay nÃºmero de WhatsApp -->
                {% if trabajo.oferta.usuario %}
                  <a href="{% url 'chats:iniciar_chat' trabajo.oferta.usuario.id %}" 
                     class="boton-contactar">
                    ğŸ’¬ Contactar Empleador
                  </a>
                {% else %}
                  <span class="boton-contactar-deshabilitado" title="Sin nÃºmero de contacto disponible">
                    ğŸ“± Sin contacto
                  </span>
                {% endif %}
              {% endif %}
              <img src="{% static 'images/comentario.png' %}" alt="MensajerÃ­a" class="mensaje-icon-btn" title="Mensaje">
            </div>
          </div>
        </div>
      {% endfor %}
    </div>
  {% else %}
    <p>No has guardado ningÃºn trabajo aÃºn.</p>
  {% endif %}
</div>
