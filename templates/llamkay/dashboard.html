{% extends "base.html" %}
{% load static %}
{% load trabajo_filters %}
{% load usuarios_extras %}

{% block title %}Dashboard - Llamkay.pe{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/llamkay/dashboard.css' %}">
{% endblock %}

{% block content %}
    <!-- ========== HEADER ========== -->
    <header class="header">
        <nav class="navbar">
            <div class="nav-container">
                <a href="{% url 'llamkay:dashboard' %}" class="logo">
                    <span>Llamkay</span>
                </a>
                
                <ul class="nav-menu">
                    <li><a href="{% url 'llamkay:dashboard' %}" class="nav-link active">Inicio</a></li>
                    <li><a href="{% url 'jobs:buscar_trabajos' %}" class="nav-link">Trabajos</a></li>
                    <li><a href="{% url 'chats:lista_chats' %}" class="nav-link">Mensajes</a></li>
                </ul>
                
                <div class="nav-actions">
                    <!-- BOTÓN DE NOTIFICACIONES -->
                    <a href="{% url 'soporte:notificaciones' %}" class="icon-button" aria-label="Notificaciones">
                        <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
                            <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
                        </svg>
                        {% if notificaciones_count > 0 %}
                        <span class="notification-badge">{{ notificaciones_count }}</span>
                        {% endif %}
                    </a>
                    
                    <div class="user-menu-wrapper">
                        <button type="button" class="user-menu" id="userMenuBtn">
                            <div class="profile-pic-placeholder">
                                {% if profile and profile.foto_url %}
                                    <img src="{{ profile.foto_url.url }}" alt="{{ usuario.nombres }}">
                                {% else %}
                                    {{ usuario.nombres|first }}{{ usuario.apellidos|first }}
                                {% endif %}
                            </div>
                            <span class="username">{{ usuario.nombres }} {{ usuario.apellidos|truncatewords:1 }}</span>
                            <svg class="dropdown-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="6 9 12 15 18 9"></polyline>
                            </svg>
                        </button>
                        
                        <!-- Dropdown Menu -->
                        <div class="user-dropdown" id="userDropdown">
                            <div class="dropdown-header">
                                <div class="dropdown-user-info">
                                    <div class="dropdown-avatar">
                                        {% if profile and profile.foto_url %}
                                            <img src="{{ profile.foto_url.url }}" alt="{{ usuario.nombres }}">
                                        {% else %}
                                            {{ usuario.nombres|first }}{{ usuario.apellidos|first }}
                                        {% endif %}
                                    </div>
                                    <div class="dropdown-user-details">
                                        <strong>{{ usuario.nombres }} {{ usuario.apellidos }}</strong>
                                        <span>{{ usuario.email }}</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="dropdown-divider"></div>
                            
                            <div class="dropdown-menu">
                                <a href="{% url 'users:perfil' %}" class="dropdown-item">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                                        <circle cx="12" cy="7" r="4"></circle>
                                    </svg>
                                    <span>Mi Perfil</span>
                                </a>
                                
                                <a href="{% url 'llamkay:dashboard' %}" class="dropdown-item">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <rect x="3" y="3" width="7" height="7"></rect>
                                        <rect x="14" y="3" width="7" height="7"></rect>
                                        <rect x="14" y="14" width="7" height="7"></rect>
                                        <rect x="3" y="14" width="7" height="7"></rect>
                                    </svg>
                                    <span>Dashboard</span>
                                </a>
                                
                                <!-- ENLACES DE SOPORTE -->
                                <a href="{% url 'soporte:notificaciones' %}" class="dropdown-item">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
                                        <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
                                    </svg>
                                    <span>Notificaciones</span>
                                    {% if notificaciones_count > 0 %}
                                    <span class="badge" style="margin-left: auto; background: #07734B; color: white; padding: 2px 8px; border-radius: 12px; font-size: 11px;">{{ notificaciones_count }}</span>
                                    {% endif %}
                                </a>
                                
                                <a href="{% url 'chats:lista_chats' %}" class="dropdown-item">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                                    </svg>
                                    <span>Mensajes</span>
                                </a>
                                
                                {% if usuario.tipo_usuario == 'trabajador' or usuario.tipo_usuario == 'ambos' %}
                                <a href="{% url 'jobs:mis_postulaciones' %}" class="dropdown-item">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                        <polyline points="14 2 14 8 20 8"></polyline>
                                    </svg>
                                    <span>Mis Postulaciones</span>
                                </a>
                                {% endif %}
                                
                                {% if usuario.tipo_usuario == 'empleador' or usuario.tipo_usuario == 'ambos' or usuario.tipo_usuario == 'empresa' %}
                                <a href="{% url 'jobs:mis_trabajos' %}" class="dropdown-item">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <rect x="2" y="7" width="20" height="14" rx="2" ry="2"></rect>
                                        <path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"></path>
                                    </svg>
                                    <span>Mis Ofertas</span>
                                </a>
                                {% endif %}
                                
                                <div class="dropdown-divider"></div>
                                
                                <!-- SECCIÓN DE SOPORTE -->
                                <a href="{% url 'soporte:denuncias' %}" class="dropdown-item">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
                                        <line x1="12" y1="9" x2="12" y2="13"></line>
                                        <line x1="12" y1="17" x2="12.01" y2="17"></line>
                                    </svg>
                                    <span>Mis Denuncias</span>
                                </a>
                                
                                <div class="dropdown-divider"></div>
                                
                                <a href="{% url 'users:perfil' %}" class="dropdown-item">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <circle cx="12" cy="12" r="3"></circle>
                                        <path d="M12 1v6m0 6v6"></path>
                                        <path d="M1 12h6m6 0h6"></path>
                                    </svg>
                                    <span>Configuración</span>
                                </a>
                            </div>
                            
                            <div class="dropdown-divider"></div>
                            
                            <div class="dropdown-footer">
                                <a href="{% url 'users:logout' %}" class="dropdown-item logout-item">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                                        <polyline points="16 17 21 12 16 7"></polyline>
                                        <line x1="21" y1="12" x2="9" y2="12"></line>
                                    </svg>
                                    <span>Cerrar Sesión</span>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </nav>
    </header>

    <!-- ========== WELCOME SECTION ========== -->
    <section class="welcome-section">
        <div class="container">
            <div class="welcome-content">
                <h1>¡Bienvenido de vuelta, <span class="text-highlight">{{ usuario.nombres }}</span>!</h1>
                <p>Aquí está un resumen de tu actividad reciente</p>
            </div>
            
            <div class="quick-actions">
                {% if usuario.tipo_usuario == 'trabajador' or usuario.tipo_usuario == 'ambos' %}
                    <a href="{% url 'jobs:buscar_trabajos' %}" class="quick-action-btn btn-primary">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="11" cy="11" r="8"></circle>
                            <path d="m21 21-4.35-4.35"></path>
                        </svg>
                        Buscar trabajos
                    </a>
                    <a href="{% url 'jobs:mis_postulaciones' %}" class="quick-action-btn btn-ghost">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                            <polyline points="14 2 14 8 20 8"></polyline>
                        </svg>
                        Mis postulaciones
                    </a>
                {% endif %}
                
                {% if usuario.tipo_usuario == 'empleador' or usuario.tipo_usuario == 'ambos' or usuario.tipo_usuario == 'empresa' %}
                    <a href="{% url 'jobs:registro_individual' %}" class="quick-action-btn btn-primary">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="12" y1="5" x2="12" y2="19"></line>
                            <line x1="5" y1="12" x2="19" y2="12"></line>
                        </svg>
                        Publicar trabajo
                    </a>
                    <a href="{% url 'jobs:mis_trabajos' %}" class="quick-action-btn btn-ghost">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                            <line x1="9" y1="9" x2="15" y2="9"></line>
                            <line x1="9" y1="15" x2="15" y2="15"></line>
                        </svg>
                        Mis ofertas
                    </a>
                {% endif %}
            </div>
        </div>
    </section>

    <!-- ========== STATS CARDS ========== -->
    <section class="stats-section">
        <div class="container">
            <div class="stats-grid">
                {% if usuario.tipo_usuario == 'trabajador' or usuario.tipo_usuario == 'ambos' %}
                    <div class="stat-card">
                        <div class="stat-icon" style="background: linear-gradient(135deg, #07734B, #15AC75);">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                                <circle cx="8.5" cy="7" r="4"></circle>
                                <polyline points="17 11 19 13 23 9"></polyline>
                            </svg>
                        </div>
                        <div class="stat-content">
                            <h3>{{ estadisticas.postulaciones_totales|default:0 }}</h3>
                            <p>Trabajos aplicados</p>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon" style="background: linear-gradient(135deg, #9EBC8A, #B5C99A);">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                                <polyline points="22 4 12 14.01 9 11.01"></polyline>
                            </svg>
                        </div>
                        <div class="stat-content">
                            <h3>{{ usuario.trabajos_completados|default:0 }}</h3>
                            <p>Trabajos completados</p>
                        </div>
                    </div>
                {% else %}
                    <div class="stat-card">
                        <div class="stat-icon" style="background: linear-gradient(135deg, #07734B, #15AC75);">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="2" y="7" width="20" height="14" rx="2" ry="2"></rect>
                                <path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"></path>
                            </svg>
                        </div>
                        <div class="stat-content">
                            <h3>{{ estadisticas.ofertas_activas|default:0 }}</h3>
                            <p>Ofertas activas</p>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon" style="background: linear-gradient(135deg, #9EBC8A, #B5C99A);">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                                <circle cx="9" cy="7" r="4"></circle>
                                <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                                <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                            </svg>
                        </div>
                        <div class="stat-content">
                            <h3>{{ estadisticas.postulantes_totales|default:0 }}</h3>
                            <p>Postulantes recibidos</p>
                        </div>
                    </div>
                {% endif %}
                
                <div class="stat-card">
                    <div class="stat-icon" style="background: linear-gradient(135deg, #FFB020, #FFC857);">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
                        </svg>
                    </div>
                    <div class="stat-content">
                        <h3>{{ usuario.rating_promedio|floatformat:1|default:"0.0" }}</h3>
                        <p>Calificación promedio</p>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon" style="background: linear-gradient(135deg, #6366F1, #8B5CF6);">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                        </svg>
                    </div>
                    <div class="stat-content">
                        <h3>{{ estadisticas.mensajes_no_leidos|default:0 }}</h3>
                        <p>Mensajes nuevos</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- ========== MAIN CONTENT ========== -->
    <section class="main-content">
        <div class="container">
            <div class="content-grid">
                <!-- Left Column -->
                <div class="content-main">
                    <!-- Recent Activity -->
                    <div class="content-card">
                        <div class="card-header">
                            <h2>Actividad reciente</h2>
                            <a href="#" class="view-all">Ver todo</a>
                        </div>
                        
                        <div class="activity-list">
                            {% for actividad in actividades_recientes %}
                                <div class="activity-item">
                                    <div class="activity-icon {{ actividad.tipo }}">
                                        {% if actividad.tipo == 'success' %}
                                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                                                <polyline points="22 4 12 14.01 9 11.01"></polyline>
                                            </svg>
                                        {% elif actividad.tipo == 'info' %}
                                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                                            </svg>
                                        {% else %}
                                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <circle cx="12" cy="12" r="10"></circle>
                                                <line x1="12" y1="8" x2="12" y2="12"></line>
                                                <line x1="12" y1="16" x2="12.01" y2="16"></line>
                                            </svg>
                                        {% endif %}
                                    </div>
                                    <div class="activity-content">
                                        <p>{{ actividad.mensaje|safe }}</p>
                                        <span class="activity-time">{{ actividad.fecha|timesince }}</span>
                                    </div>
                                </div>
                            {% empty %}
                                <p style="text-align: center; color: #666; padding: 2rem;">No hay actividad reciente</p>
                            {% endfor %}
                        </div>
                    </div>

                    <!-- Recommended Jobs -->
                    <div class="content-card">
                        <div class="card-header">
                            {% if usuario.tipo_usuario == 'trabajador' or usuario.tipo_usuario == 'ambos' %}
                                <h2>Trabajos recomendados para ti</h2>
                                <a href="{% url 'jobs:buscar_trabajos' %}" class="view-all">Ver más</a>
                            {% else %}
                                <h2>Postulantes recientes</h2>
                                <a href="{% url 'jobs:mis_trabajos' %}" class="view-all">Ver todas</a>
                            {% endif %}
                        </div>
                        
                        <div class="jobs-list">
                            {% for trabajo in trabajos_recomendados %}
                                <div class="job-card">
                                    <div class="job-header">
                                        <div class="job-icon">
                                            {% if trabajo.id_categoria %}
                                                {{ trabajo.id_categoria.icono|default:"🔨" }}
                                            {% else %}
                                                🔨
                                            {% endif %}
                                        </div>
                                        <div class="job-info">
                                            <h3>
                                                <a href="{% url_detalle_trabajo trabajo %}">
                                                    {{ trabajo|get_titulo_trabajo }}
                                                </a>
                                            </h3>
                                            <p class="job-company">
                                                {% with empleador=trabajo|get_empleador_trabajo %}
                                                    {% if empleador %}
                                                        {{ empleador.nombres }} {{ empleador.apellidos }}
                                                    {% endif %}
                                                {% endwith %}
                                                {% with distrito=trabajo|get_distrito_trabajo %}
                                                    {% if distrito %}
                                                        · {{ distrito.nombre }}
                                                    {% endif %}
                                                {% endwith %}
                                            </p>
                                        </div>
                                        {% if trabajo|is_urgente %}
                                            <span class="job-badge urgent">Urgente</span>
                                        {% else %}
                                            {% with fecha=trabajo|get_created_at %}
                                                {% if fecha %}
                                                    {% if fecha|timesince < "1 day" %}
                                                        <span class="job-badge new">Nuevo</span>
                                                    {% endif %}
                                                {% endif %}
                                            {% endwith %}
                                        {% endif %}
                                    </div>
                                    <p class="job-description">{{ trabajo|get_descripcion_trabajo|truncatewords:20 }}</p>
                                    <div class="job-footer">
                                        <span class="job-price">
                                            {% with pago=trabajo|get_pago_trabajo %}
                                                {% if pago %}
                                                    S/ {{ pago }}
                                                {% endif %}
                                            {% endwith %}
                                        </span>
                                        <span class="job-time">
                                            {% with fecha=trabajo|get_created_at %}
                                                {% if fecha %}
                                                    Publicado {{ fecha|timesince }}
                                                {% endif %}
                                            {% endwith %}
                                        </span>
                                        {% if usuario.tipo_usuario == 'trabajador' or usuario.tipo_usuario == 'ambos' %}
                                            <a href="{% url_postular_trabajo trabajo %}" class="btn-small btn-primary">Aplicar</a>
                                        {% else %}
                                            <a href="{% url_detalle_trabajo trabajo %}" class="btn-small btn-primary">Ver detalles</a>
                                        {% endif %}
                                    </div>
                                </div>
                            {% empty %}
                                <p style="text-align: center; color: #666; padding: 2rem;">No hay trabajos disponibles en este momento</p>
                            {% endfor %}
                        </div>
                    </div>
                </div>

                <!-- Right Sidebar -->
                <div class="content-sidebar">
                    <!-- Profile Completion -->
                    <div class="sidebar-card">
                        <h3>Completa tu perfil</h3>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: {{ perfil_completado }}%"></div>
                        </div>
                        <p class="progress-text">{{ perfil_completado }}% completado</p>
                        
                        <div class="profile-tasks">
                            <div class="task-item {% if usuario.nombres and usuario.apellidos %}completed{% endif %}">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    {% if usuario.nombres and usuario.apellidos %}
                                        <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                                        <polyline points="22 4 12 14.01 9 11.01"></polyline>
                                    {% else %}
                                        <circle cx="12" cy="12" r="10"></circle>
                                    {% endif %}
                                </svg>
                                <span>Información básica</span>
                            </div>
                            <div class="task-item {% if usuario.profile.foto_url %}completed{% endif %}">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    {% if usuario.profile.foto_url %}
                                        <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                                        <polyline points="22 4 12 14.01 9 11.01"></polyline>
                                    {% else %}
                                        <circle cx="12" cy="12" r="10"></circle>
                                    {% endif %}
                                </svg>
                                <span>Foto de perfil</span>
                            </div>
                            <div class="task-item {% if usuario.estado_verificacion == 'verificado' %}completed{% endif %}">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    {% if usuario.estado_verificacion == 'verificado' %}
                                        <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                                        <polyline points="22 4 12 14.01 9 11.01"></polyline>
                                    {% else %}
                                        <circle cx="12" cy="12" r="10"></circle>
                                    {% endif %}
                                </svg>
                                <span>Verificar identidad</span>
                            </div>
                            <div class="task-item {% if usuario.habilidades.count > 0 %}completed{% endif %}">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    {% if usuario.habilidades.count > 0 %}
                                        <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                                        <polyline points="22 4 12 14.01 9 11.01"></polyline>
                                    {% else %}
                                        <circle cx="12" cy="12" r="10"></circle>
                                    {% endif %}
                                </svg>
                                <span>Agregar habilidades</span>
                            </div>
                        </div>
                        
                        <a href="{% url 'users:perfil' %}" class="btn-small btn-block btn-ghost">Completar perfil</a>
                    </div>

                    <!-- Quick Stats -->
                    <div class="sidebar-card">
                        <h3>Tu rendimiento</h3>
                        {% if usuario.tipo_usuario == 'trabajador' or usuario.tipo_usuario == 'ambos' %}
                            <div class="quick-stat">
                                <span class="stat-label">Tasa de aceptación</span>
                                <span class="stat-value">{{ estadisticas.tasa_aceptacion|default:"0" }}%</span>
                            </div>
                            <div class="quick-stat">
                                <span class="stat-label">Trabajos completados</span>
                                <span class="stat-value">{{ usuario.trabajos_completados }}</span>
                            </div>
                        {% else %}
                            <div class="quick-stat">
                                <span class="stat-label">Ofertas publicadas</span>
                                <span class="stat-value">{{ estadisticas.ofertas_totales|default:0 }}</span>
                            </div>
                            <div class="quick-stat">
                                <span class="stat-label">Contratos activos</span>
                                <span class="stat-value">{{ estadisticas.contratos_activos|default:0 }}</span>
                            </div>
                            <div class="quick-stat">
                                <span class="stat-label">Vistas totales</span>
                                <span class="stat-value">{{ estadisticas.vistas_totales|default:0 }}</span>
                            </div>
                        {% endif %}
                    </div>

                    <!-- NOTIFICACIONES RECIENTES - INTEGRACIÓN SOPORTE -->
                    {% if notificaciones_recientes %}
                    <div class="sidebar-card">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                            <h3 style="margin: 0;">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align: middle; margin-right: 8px;">
                                    <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
                                    <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
                                </svg>
                                Notificaciones
                            </h3>
                            {% if notificaciones_count > 0 %}
                            <span style="background: #07734B; color: white; padding: 4px 10px; border-radius: 12px; font-size: 12px; font-weight: 600;">
                                {{ notificaciones_count }}
                            </span>
                            {% endif %}
                        </div>
                        <div class="notificaciones-preview">
                            {% for notif in notificaciones_recientes %}
                            <a href="{{ notif.url|default:'#' }}" class="notificacion-preview-item {% if not notif.leida %}no-leida{% endif %}">
                                <div class="notif-icon {{ notif.tipo }}">
                                    {% if notif.tipo == 'postulacion' %}
                                        📋
                                    {% elif notif.tipo == 'mensaje' %}
                                        💬
                                    {% elif notif.tipo == 'contrato' %}
                                        📝
                                    {% elif notif.tipo == 'pago' %}
                                        💰
                                    {% elif notif.tipo == 'calificacion' %}
                                        ⭐
                                    {% else %}
                                        🔔
                                    {% endif %}
                                </div>
                                <div class="notif-content">
                                    <strong>{{ notif.titulo|truncatewords:8 }}</strong>
                                    <span class="notif-time">{{ notif.created_at|timesince }}</span>
                                </div>
                            </a>
                            {% endfor %}
                        </div>
                        <a href="{% url 'soporte:notificaciones' %}" class="btn-small btn-block btn-ghost" style="margin-top: 1rem;">
                            Ver todas las notificaciones
                        </a>
                    </div>
                    {% endif %}

                    <!-- Tips -->
                    <div class="sidebar-card tips-card">
                        <div class="tips-icon">💡</div>
                        <h3>Consejo del día</h3>
                        <p>{{ consejo_del_dia|default:"Responde rápido a los mensajes para aumentar tus posibilidades de conseguir trabajos. Los usuarios valoran la comunicación ágil." }}</p>
                    </div>

                    <!-- Mensajes recientes -->
                    {% if conversaciones_recientes %}
                    <div class="sidebar-card">
                        <h3>Mensajes recientes</h3>
                        <div class="mensajes-preview">
                            {% for conv in conversaciones_recientes %}
                                <a href="{% url 'chats:ver_chat_por_id' chat_id=conv.id_conversacion %}" class="mensaje-item">
                                    <div class="mensaje-avatar">
                                        {% with otro_usuario=conv.obtener_otro_usuario %}
                                            {% if otro_usuario.profile.foto_url %}
                                                <img src="{{ otro_usuario.profile.foto_url.url }}" alt="{{ otro_usuario.nombres }}">
                                            {% else %}
                                                {{ otro_usuario.nombres|first }}{{ otro_usuario.apellidos|first }}
                                            {% endif %}
                                        {% endwith %}
                                    </div>
                                    <div class="mensaje-info">
                                        <strong>{{ conv.obtener_otro_usuario.nombres }}</strong>
                                        <p>{{ conv.ultimo_mensaje|truncatewords:5 }}</p>
                                    </div>
                                </a>
                            {% endfor %}
                        </div>
                        <a href="{% url 'chats:lista_chats' %}" class="btn-small btn-block btn-ghost" style="margin-top: 1rem;">Ver todos</a>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </section>

    <!-- ========== FOOTER ========== -->
    <footer class="footer">
        <div class="footer-container">
            <div class="footer-brand">
                <div class="footer-logo">
                    <span>Llamkay</span>
                </div>
                <p>Conectando talentos con oportunidades laborales en todo el Perú</p>
            </div>
            
            <div class="footer-links">
                <div class="footer-column">
                    <h4>Plataforma</h4>
                    <ul>
                        <li><a href="{% url 'jobs:buscar_trabajos' %}">Buscar trabajos</a></li>
                        <li><a href="{% url 'users:perfil' %}">Mi Perfil</a></li>
                        <li><a href="{% url 'chats:lista_chats' %}">Mis Mensajes</a></li>
                    </ul>
                </div>
                
                <div class="footer-column">
                    <h4>Soporte</h4>
                    <ul>
                        <li><a href="#">Centro de ayuda</a></li>
                        <li><a href="{% url 'soporte:denuncias' %}">Mis Denuncias</a></li>
                        <li><a href="#">Términos de servicio</a></li>
                        <li><a href="#">Política de privacidad</a></li>
                    </ul>
                </div>
            </div>
        </div>
        
        <div class="footer-bottom">
            <p>&copy; 2025 Llamkay.pe. Todos los derechos reservados.</p>
        </div>
    </footer>

{% endblock %}

{% block extra_js %}
<script src="{% static 'js/llamkay/dashboard.js' %}"></script>
{% endblock %}