{% extends "base.html" %}
{% load static %}

{% block title %}{{ titulo }} - Llamkay{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/soporte/disputas.css' %}">
{% endblock %}

{% block content %}
<div class="disputas-page">
    <!-- Header -->
    <div class="page-header">
        <div class="container">
            <div class="header-content">
                <div class="header-text">
                    <h1>
                        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
                        </svg>
                        {{ titulo }}
                    </h1>
                    <p>Sistema de mediación de conflictos</p>
                </div>
                
                <div class="header-actions">
                    <a href="{% url 'soporte:crear_disputa' %}" class="btn btn-white">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="12" y1="5" x2="12" y2="19"></line>
                            <line x1="5" y1="12" x2="19" y2="12"></line>
                        </svg>
                        Nueva Disputa
                    </a>
                </div>
            </div>
            
            <!-- Filtros -->
            <div class="filtros-container">
                <div class="filtro-badge {% if not estado_actual %}active{% endif %}">
                    <a href="{% url 'soporte:disputas' %}">Todas</a>
                </div>
                {% for estado_id, estado_nombre in estados %}
                <div class="filtro-badge {% if estado_actual == estado_id %}active{% endif %}">
                    <a href="?estado={{ estado_id }}">{{ estado_nombre }}</a>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>

    <!-- Lista de Disputas -->
    <div class="disputas-container">
        <div class="container">
            {% if disputas %}
                <div class="disputas-grid">
                    {% for disputa in disputas %}
                    <div class="disputa-card" data-estado="{{ disputa.estado }}">
                        <div class="disputa-header">
                            <div class="disputa-badge estado-{{ disputa.estado }}">
                                {{ disputa.get_estado_display }}
                            </div>
                            <div class="disputa-id">
                                Disputa #{{ disputa.id_disputa }}
                            </div>
                        </div>
                        
                        <div class="disputa-contrato">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                <polyline points="14 2 14 8 20 8"></polyline>
                            </svg>
                            <a href="{% url 'jobs:detalle_contrato' disputa.id_contrato.id_contrato %}">
                                Contrato #{{ disputa.id_contrato.id_contrato }}
                            </a>
                        </div>
                        
                        <div class="disputa-info">
                            <div class="info-row">
                                <span class="info-label">Iniciada por:</span>
                                <strong>{{ disputa.id_iniciada_por.nombres }} {{ disputa.id_iniciada_por.apellidos }}</strong>
                            </div>
                            
                            <div class="info-row">
                                <span class="info-label">Fecha:</span>
                                <span>{{ disputa.created_at|date:"d/m/Y H:i" }}</span>
                            </div>
                            
                            {% if disputa.id_mediador %}
                            <div class="info-row">
                                <span class="info-label">Mediador:</span>
                                <span>{{ disputa.id_mediador.nombres }}</span>
                            </div>
                            {% endif %}
                            
                            {% if disputa.monto_resolucion %}
                            <div class="info-row">
                                <span class="info-label">Monto:</span>
                                <strong class="monto">S/. {{ disputa.monto_resolucion }}</strong>
                            </div>
                            {% endif %}
                        </div>
                        
                        <div class="disputa-motivo">
                            <p>{{ disputa.motivo|truncatewords:25 }}</p>
                        </div>
                        
                        <div class="disputa-actions">
                            <a href="{% url 'soporte:detalle_disputa' disputa.id_disputa %}" class="btn btn-primary">
                                Ver Detalles
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="5" y1="12" x2="19" y2="12"></line>
                                    <polyline points="12 5 19 12 12 19"></polyline>
                                </svg>
                            </a>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                
                <!-- Paginación -->
                {% if disputas.has_other_pages %}
                <div class="pagination">
                    {% if disputas.has_previous %}
                    <a href="?page={{ disputas.previous_page_number }}{% if estado_actual %}&estado={{ estado_actual }}{% endif %}" class="page-link">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="15 18 9 12 15 6"></polyline>
                        </svg>
                        Anterior
                    </a>
                    {% endif %}
                    
                    <span class="page-info">
                        Página {{ disputas.number }} de {{ disputas.paginator.num_pages }}
                    </span>
                    
                    {% if disputas.has_next %}
                    <a href="?page={{ disputas.next_page_number }}{% if estado_actual %}&estado={{ estado_actual }}{% endif %}" class="page-link">
                        Siguiente
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="9 18 15 12 9 6"></polyline>
                        </svg>
                    </a>
                    {% endif %}
                </div>
                {% endif %}
            {% else %}
                <div class="empty-state">
                    <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                        <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
                    </svg>
                    <h2>No hay disputas</h2>
                    <p>{% if estado_actual %}No se encontraron disputas con este estado{% else %}Aún no has iniciado ninguna disputa{% endif %}</p>
                    <a href="{% url 'soporte:crear_disputa' %}" class="btn btn-primary">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="12" y1="5" x2="12" y2="19"></line>
                            <line x1="5" y1="12" x2="19" y2="12"></line>
                        </svg>
                        Crear Primera Disputa
                    </a>
                </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/soporte/disputas.js' %}"></script>
{% endblock %}