{% extends "jobs/base_jobs.html" %}

{% block title %}{% if modo_edicion %}Editar{% else %}Publicar{% endif %} Oferta de Empresa - Llamkay{% endblock %}

{% block extra_css %}
<style>
    .form-container {
        max-width: 800px;
        margin: 30px auto;
    }
    
    .form-header {
        background: linear-gradient(135deg, #1565C0, #1976D2);
        color: white;
        padding: 30px;
        border-radius: 12px 12px 0 0;
        text-align: center;
    }
    
    .form-header h1 {
        font-size: 28px;
        margin-bottom: 10px;
    }
    
    .form-header p {
        opacity: 0.9;
        font-size: 16px;
    }
    
    .form-body {
        background: white;
        padding: 30px;
        border-radius: 0 0 12px 12px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    
    .form-section {
        margin-bottom: 30px;
        padding-bottom: 30px;
        border-bottom: 2px solid #f0f0f0;
    }
    
    .form-section:last-child {
        border-bottom: none;
        margin-bottom: 0;
    }
    
    .form-section h3 {
        color: #1565C0;
        margin-bottom: 20px;
        font-size: 20px;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin-bottom: 15px;
    }
    
    .form-row.full {
        grid-template-columns: 1fr;
    }
    
    .form-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        color: #333;
    }
    
    .form-group label.required::after {
        content: " *";
        color: #dc3545;
    }
    
    .form-control {
        width: 100%;
        padding: 12px;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        font-size: 15px;
        transition: border-color 0.3s;
    }
    
    .form-control:focus {
        outline: none;
        border-color: #1565C0;
    }
    
    .form-control.error {
        border-color: #dc3545;
    }
    
    .help-text {
        font-size: 13px;
        color: #666;
        margin-top: 5px;
        display: block;
    }
    
    .error-message {
        color: #dc3545;
        font-size: 13px;
        margin-top: 5px;
        display: block;
    }
    
    .form-actions {
        display: flex;
        gap: 15px;
        margin-top: 30px;
    }
    
    .form-actions .btn {
        flex: 1;
        padding: 14px;
        font-size: 16px;
    }
    
    .info-box {
        background: #e3f2fd;
        border-left: 4px solid #1976D2;
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 20px;
    }
    
    .info-box p {
        margin: 0;
        color: #0d47a1;
    }
    
    @media (max-width: 768px) {
        .form-row {
            grid-template-columns: 1fr;
        }
        
        .form-actions {
            flex-direction: column;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="form-container">
    <div class="form-header">
        <h1>
            {% if modo_edicion %}
                ‚úèÔ∏è Editar Oferta de Empleo
            {% else %}
                üè¢ Publicar Nueva Oferta de Empleo
            {% endif %}
        </h1>
        <p>
            {% if modo_edicion %}
                Actualiza la informaci√≥n de tu vacante
            {% else %}
                Publica una oferta de empleo para tu empresa
            {% endif %}
        </p>
    </div>
    
    <div class="form-body">
        {% if not modo_edicion %}
        <div class="info-box">
            <p><strong>üí° Consejo:</strong> Las ofertas detalladas y con informaci√≥n clara atraen candidatos de mayor calidad.</p>
        </div>
        {% endif %}
        
        <form method="POST" enctype="multipart/form-data" id="ofertaForm">
            {% csrf_token %}
            
            <!-- Informaci√≥n del Puesto -->
            <div class="form-section">
                <h3>üìã Informaci√≥n del Puesto</h3>
                
                <div class="form-group">
                    <label for="{{ form.titulo_puesto.id_for_label }}" class="required">T√≠tulo del Puesto</label>
                    {{ form.titulo_puesto }}
                    <span class="help-text">Ejemplo: "Desarrollador Full Stack", "Contador Senior"</span>
                    {% if form.titulo_puesto.errors %}
                        <span class="error-message">{{ form.titulo_puesto.errors.0 }}</span>
                    {% endif %}
                </div>
                
                <div class="form-group">
                    <label for="{{ form.id_categoria.id_for_label }}" class="required">Categor√≠a</label>
                    {{ form.id_categoria }}
                    {% if form.id_categoria.errors %}
                        <span class="error-message">{{ form.id_categoria.errors.0 }}</span>
                    {% endif %}
                </div>
                
                <div class="form-group">
                    <label for="{{ form.descripcion.id_for_label }}" class="required">Descripci√≥n del Puesto</label>
                    {{ form.descripcion }}
                    <span class="help-text">Describe responsabilidades, requisitos, beneficios, etc.</span>
                    {% if form.descripcion.errors %}
                        <span class="error-message">{{ form.descripcion.errors.0 }}</span>
                    {% endif %}
                </div>
            </div>
            
            <!-- Compensaci√≥n -->
            <div class="form-section">
                <h3>üí∞ Compensaci√≥n</h3>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="{{ form.modalidad_pago.id_for_label }}" class="required">Modalidad de Pago</label>
                        {{ form.modalidad_pago }}
                        {% if form.modalidad_pago.errors %}
                            <span class="error-message">{{ form.modalidad_pago.errors.0 }}</span>
                        {% endif %}
                    </div>
                    
                    <div class="form-group">
                        <label for="{{ form.pago.id_for_label }}">Salario (S/)</label>
                        {{ form.pago }}
                        <span class="help-text">Opcional: Salario mensual o por hora</span>
                        {% if form.pago.errors %}
                            <span class="error-message">{{ form.pago.errors.0 }}</span>
                        {% endif %}
                    </div>
                </div>
            </div>
            
            <!-- Requisitos -->
            <div class="form-section">
                <h3>üìå Requisitos y Vacantes</h3>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="{{ form.experiencia_requerida.id_for_label }}">Experiencia Requerida</label>
                        {{ form.experiencia_requerida }}
                        <span class="help-text">Ejemplo: "2 a√±os", "Sin experiencia"</span>
                        {% if form.experiencia_requerida.errors %}
                            <span class="error-message">{{ form.experiencia_requerida.errors.0 }}</span>
                        {% endif %}
                    </div>
                    
                    <div class="form-group">
                        <label for="{{ form.vacantes.id_for_label }}" class="required">N√∫mero de Vacantes</label>
                        {{ form.vacantes }}
                        <span class="help-text">¬øCu√°ntas personas necesitas contratar?</span>
                        {% if form.vacantes.errors %}
                            <span class="error-message">{{ form.vacantes.errors.0 }}</span>
                        {% endif %}
                    </div>
                </div>
            </div>
            
            <!-- Ubicaci√≥n -->
            <div class="form-section">
                <h3>üìç Ubicaci√≥n del Trabajo</h3>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="{{ form.id_departamento.id_for_label }}" class="required">Departamento</label>
                        {{ form.id_departamento }}
                        {% if form.id_departamento.errors %}
                            <span class="error-message">{{ form.id_departamento.errors.0 }}</span>
                        {% endif %}
                    </div>
                    
                    <div class="form-group">
                        <label for="{{ form.id_provincia.id_for_label }}" class="required">Provincia</label>
                        {{ form.id_provincia }}
                        {% if form.id_provincia.errors %}
                            <span class="error-message">{{ form.id_provincia.errors.0 }}</span>
                        {% endif %}
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="{{ form.id_distrito.id_for_label }}" class="required">Distrito</label>
                        {{ form.id_distrito }}
                        {% if form.id_distrito.errors %}
                            <span class="error-message">{{ form.id_distrito.errors.0 }}</span>
                        {% endif %}
                    </div>
                </div>
            </div>
            
            <!-- Errores generales del formulario -->
            {% if form.non_field_errors %}
                <div class="alert alert-error">
                    {{ form.non_field_errors }}
                </div>
            {% endif %}
            
            <!-- Acciones -->
            <div class="form-actions">
                <a href="{% url 'jobs:mis_trabajos' %}" class="btn btn-secondary">
                    ‚ùå Cancelar
                </a>
                <button type="submit" class="btn btn-primary">
                    {% if modo_edicion %}
                        ‚úÖ Guardar Cambios
                    {% else %}
                        ‚úÖ Publicar Oferta
                    {% endif %}
                </button>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const departamentoSelect = document.getElementById('{{ form.id_departamento.id_for_label }}');
    const provinciaSelect = document.getElementById('{{ form.id_provincia.id_for_label }}');
    const distritoSelect = document.getElementById('{{ form.id_distrito.id_for_label }}');
    
    // Cargar provincias cuando cambia departamento
    departamentoSelect.addEventListener('change', function() {
        const departamentoId = this.value;
        
        provinciaSelect.innerHTML = '<option value="">Cargando...</option>';
        distritoSelect.innerHTML = '<option value="">Seleccione distrito</option>';
        
        if (departamentoId) {
            fetch(`/jobs/ajax/cargar-provincias/?id_departamento=${departamentoId}`)
                .then(response => response.json())
                .then(data => {
                    provinciaSelect.innerHTML = '<option value="">Seleccione provincia</option>';
                    data.forEach(prov => {
                        const option = document.createElement('option');
                        option.value = prov.id_provincia;
                        option.textContent = prov.nombre;
                        provinciaSelect.appendChild(option);
                    });
                })
                .catch(error => {
                    console.error('Error:', error);
                    provinciaSelect.innerHTML = '<option value="">Error al cargar</option>';
                });
        } else {
            provinciaSelect.innerHTML = '<option value="">Seleccione provincia</option>';
        }
    });
    
    // Cargar distritos cuando cambia provincia
    provinciaSelect.addEventListener('change', function() {
        const provinciaId = this.value;
        
        distritoSelect.innerHTML = '<option value="">Cargando...</option>';
        
        if (provinciaId) {
            fetch(`/jobs/ajax/cargar-distritos/?id_provincia=${provinciaId}`)
                .then(response => response.json())
                .then(data => {
                    distritoSelect.innerHTML = '<option value="">Seleccione distrito</option>';
                    data.forEach(dist => {
                        const option = document.createElement('option');
                        option.value = dist.id_distrito;
                        option.textContent = dist.nombre;
                        distritoSelect.appendChild(option);
                    });
                })
                .catch(error => {
                    console.error('Error:', error);
                    distritoSelect.innerHTML = '<option value="">Error al cargar</option>';
                });
        } else {
            distritoSelect.innerHTML = '<option value="">Seleccione distrito</option>';
        }
    });
    
    // Validaci√≥n del formulario antes de enviar
    document.getElementById('ofertaForm').addEventListener('submit', function(e) {
        let hasErrors = false;
        
        // Validar campos requeridos
        const requiredFields = [
            { id: '{{ form.titulo_puesto.id_for_label }}', name: 'T√≠tulo del puesto' },
            { id: '{{ form.descripcion.id_for_label }}', name: 'Descripci√≥n' },
            { id: '{{ form.id_categoria.id_for_label }}', name: 'Categor√≠a' },
            { id: '{{ form.modalidad_pago.id_for_label }}', name: 'Modalidad de pago' },
            { id: '{{ form.vacantes.id_for_label }}', name: 'N√∫mero de vacantes' },
            { id: '{{ form.id_departamento.id_for_label }}', name: 'Departamento' },
            { id: '{{ form.id_provincia.id_for_label }}', name: 'Provincia' },
            { id: '{{ form.id_distrito.id_for_label }}', name: 'Distrito' }
        ];
        
        requiredFields.forEach(field => {
            const element = document.getElementById(field.id);
            if (element && !element.value.trim()) {
                element.classList.add('error');
                hasErrors = true;
            } else if (element) {
                element.classList.remove('error');
            }
        });
        
        if (hasErrors) {
            e.preventDefault();
            alert('Por favor completa todos los campos requeridos (marcados con *)');
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
    });
});
</script>
{% endblock %}