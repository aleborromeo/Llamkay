{% extends "jobs/base_jobs.html" %}

{% block title %}Mis Postulaciones - Llamkay{% endblock %}

{% block extra_css %}
<style>
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin-bottom: 30px;
    }
    
    .stat-card {
        background: white;
        padding: 20px;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        text-align: center;
    }
    
    .stat-number {
        font-size: 36px;
        font-weight: 700;
        color: #07734B;
    }
    
    .stat-label {
        color: #666;
        margin-top: 5px;
    }
    
    .postulacion-card {
        background: white;
        padding: 20px;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        margin-bottom: 15px;
        border-left: 4px solid #ddd;
    }
    
    .postulacion-card.pendiente {
        border-left-color: #ffc107;
    }
    
    .postulacion-card.en_revision {
        border-left-color: #17a2b8;
    }
    
    .postulacion-card.aceptada {
        border-left-color: #28a745;
    }
    
    .postulacion-card.rechazada {
        border-left-color: #dc3545;
    }
    
    .postulacion-header {
        display: flex;
        justify-content: space-between;
        align-items: start;
        margin-bottom: 15px;
    }
    
    .postulacion-title {
        font-size: 20px;
        font-weight: 700;
        color: #333;
        margin-bottom: 5px;
    }
    
    .postulacion-meta {
        color: #666;
        font-size: 14px;
    }
    
    .estado-badge {
        padding: 6px 16px;
        border-radius: 20px;
        font-size: 14px;
        font-weight: 600;
    }
    
    .estado-pendiente {
        background: #fff3cd;
        color: #856404;
    }
    
    .estado-en_revision {
        background: #d1ecf1;
        color: #0c5460;
    }
    
    .estado-aceptada {
        background: #d4edda;
        color: #155724;
    }
    
    .estado-rechazada {
        background: #f8d7da;
        color: #721c24;
    }
</style>
{% endblock %}

{% block content %}
<div class="container">
    <h1 style="margin: 20px 0;">üìã Mis Postulaciones</h1>
    
    <!-- Estad√≠sticas -->
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-number">{{ estadisticas.total_postulaciones }}</div>
            <div class="stat-label">Total Postulaciones</div>
        </div>
        <div class="stat-card">
            <div class="stat-number">{{ estadisticas.postulaciones_pendientes }}</div>
            <div class="stat-label">Pendientes</div>
        </div>
        <div class="stat-card">
            <div class="stat-number">{{ estadisticas.postulaciones_aceptadas }}</div>
            <div class="stat-label">Aceptadas</div>
        </div>
        <div class="stat-card">
            <div class="stat-number">{{ estadisticas.tasa_aceptacion }}%</div>
            <div class="stat-label">Tasa de Aceptaci√≥n</div>
        </div>
    </div>
    
    <!-- Filtros -->
    <div class="card" style="margin-bottom: 20px;">
        <form method="GET" style="display: flex; gap: 15px; align-items: end;">
            <div class="form-group" style="flex: 1; margin: 0;">
                <label>Filtrar por estado</label>
                <select name="estado" class="form-control" onchange="this.form.submit()">
                    <option value="">Todos</option>
                    <option value="pendiente" {% if estado_filtro == 'pendiente' %}selected{% endif %}>Pendientes</option>
                    <option value="en_revision" {% if estado_filtro == 'en_revision' %}selected{% endif %}>En Revisi√≥n</option>
                    <option value="aceptada" {% if estado_filtro == 'aceptada' %}selected{% endif %}>Aceptadas</option>
                    <option value="rechazada" {% if estado_filtro == 'rechazada' %}selected{% endif %}>Rechazadas</option>
                </select>
            </div>
        </form>
    </div>
    
    <!-- Lista de Postulaciones -->
    {% for post in postulaciones %}
    <div class="postulacion-card {{ post.estado }}">
        <div class="postulacion-header">
            <div style="flex: 1;">
                <h3 class="postulacion-title">{{ post.titulo }}</h3>
                <p class="postulacion-meta">
                    Empleador: {{ post.empleador.nombre }} | 
                    Postulado: {{ post.fecha_postulacion|date:"d/m/Y H:i" }}
                </p>
            </div>
            <span class="estado-badge estado-{{ post.estado }}">
                {% if post.estado == 'pendiente' %}‚è≥ Pendiente
                {% elif post.estado == 'en_revision' %}üëÄ En Revisi√≥n
                {% elif post.estado == 'aceptada' %}‚úì Aceptada
                {% elif post.estado == 'rechazada' %}‚úó Rechazada
                {% endif %}
            </span>
        </div>
        
        {% if post.mensaje %}
        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
            <strong>Tu mensaje:</strong>
            <p style="margin-top: 5px; color: #666;">{{ post.mensaje|truncatewords:50 }}</p>
        </div>
        {% endif %}
        
        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
            <a href="{% url 'jobs:detalle_trabajo' post.tipo post.oferta_id %}" class="btn btn-primary">Ver Oferta</a>
            
            {% if post.estado in 'pendiente,en_revision' %}
            <form method="POST" action="{% url 'jobs:retirar_postulacion' post.id %}" style="display: inline;" onsubmit="return confirm('¬øEst√°s seguro de que deseas retirar esta postulaci√≥n?');">
                {% csrf_token %}
                <button type="submit" class="btn btn-danger">üóëÔ∏è Retirar Postulaci√≥n</button>
            </form>
            {% endif %}
            
            {% if post.estado == 'aceptada' %}
            <a href="{% url 'chats:ver_chat' post.empleador.id %}" class="btn btn-success">üí¨ Contactar Empleador</a>
            {% endif %}
        </div>
    </div>
    {% empty %}
    <div class="card" style="text-align: center; padding: 60px 20px;">
        <h2 style="color: #999;">No tienes postulaciones a√∫n</h2>
        <p style="color: #666; margin: 20px 0;">¬°Explora las ofertas de trabajo y comienza a postular!</p>
        <a href="{% url 'jobs:buscar_trabajos' %}" class="btn btn-primary">üîç Buscar Trabajos</a>
    </div>
    {% endfor %}
</div>
{% endblock %}